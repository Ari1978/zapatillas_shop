<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{title}}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/cart.css">
</head>
<body>
  <div class="container my-4">
    <h1>{{title}}</h1>
    <div class="d-flex justify-content-between align-items-center mb-4">
      <span class="fw-bold me-3">Hola, {{user.first_name}}</span>
      <a href="/api/sessions/logout" class="btn btn-danger btn-sm me-2">Cerrar sesión</a>
      <a href="/shop" class="btn btn-primary btn-sm">Seguir comprando</a>
    </div>

    <div class="row" id="cart-container">
      {{#if cart.products.length}}
        {{#each cart.products}}
          <div class="col-sm-12 col-md-6 col-lg-4 mb-3 cart-product-card">
            <div class="card h-100 shadow-sm">
              <img src="{{this.product.image}}" class="card-img-top" alt="{{this.product.title}}">
              <div class="card-body d-flex flex-column">
                <h5 class="card-title">{{this.product.title}}</h5>
                <p class="card-text text-truncate">{{this.product.description}}</p>
                <p><strong>Precio:</strong> ${{this.product.price}}</p>
                <p><strong>Cantidad:</strong> {{this.quantity}}</p>
                <p><strong>Total:</strong> ${{multiply this.product.price this.quantity}}</p>
                <button 
                  class="btn btn-danger mt-auto remove-from-cart-btn"
                  data-id="{{this.product._id}}"
                  data-cart="{{../cart._id}}">
                  Eliminar del carrito
                </button> 

              </div>
          </div>
        {{/each}}
      {{else}}
        <p>Tu carrito está vacío.</p>
      {{/if}}
    </div>

    {{#if cart.products.length}}
      <div class="mt-4 text-end">
        <h4>Total: ${{calculateTotal cart.products}}</h4>
        <button id="checkoutBtn" class="btn btn-success btn-sm">Finalizar compra</button>
      </div>
    {{/if}}
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.min.js"></script>
  <script>
    Handlebars.registerHelper('multiply', (a, b) => a * b);
    Handlebars.registerHelper('calculateTotal', products => products.reduce((sum, p) => sum + p.product.price * p.quantity, 0));
  </script>
  <script src="/js/cart.js"></script>
</body>
</html>
