<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Perfil de {{user.first_name}}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div class="container my-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h1>Perfil de {{user.first_name}}</h1>
      <a href="/vistas/shop" class="btn btn-outline-primary">Volver a la tienda</a>
    </div>

    <!-- Información básica -->
    <div class="card mb-4 p-3 shadow-sm">
      <div class="row align-items-center">
        <div class="col-md-3 text-center">
          <img src="{{user.avatarUrl}}" alt="Foto de perfil" class="rounded-circle" width="120">
        </div>
        <div class="col-md-9">
          <p><strong>Nombre:</strong> {{user.first_name}} {{user.last_name}}</p>
          <p><strong>Email:</strong> {{user.email}}</p>
          <p><strong>Registrado desde:</strong> {{formatDate user.createdAt}}</p>
          <a href="/vistas/profile/edit" class="btn btn-secondary btn-sm me-2">Editar perfil</a>
          <a href="/vistas/profile/change-password" class="btn btn-warning btn-sm">Cambiar contraseña</a>
        </div>
      </div>
    </div>

    <!-- Historial de compras -->
    <div class="card mb-4 p-3 shadow-sm">
      <h3>Historial de Compras</h3>
      {{#if tickets.length}}
        <ul class="list-group">
          {{#each tickets}}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <a href="/tickets/{{this.id}}">Ticket #{{this.code}}</a>
              <span>Total: ${{this.amount}}</span>
              <span>{{formatDate this.purchase_datetime}}</span>
            </li>
          {{/each}}
        </ul>
      {{else}}
        <p>No has realizado compras aún.</p>
      {{/if}}
    </div>

    
    <div class="card mb-4 p-3 shadow-sm">
      <h3>Carrito Actual</h3>
      {{#if cart.products.length}}
        <ul class="list-group">
          {{#each cart.products}}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              {{this.product.title}} (x{{this.quantity}})
              <span>$ {{multiply this.product.price this.quantity}}</span>
            </li>
          {{/each}}
        </ul>
        <p class="mt-2"><strong>Total:</strong> ${{cartTotal}}</p>
        <a href="/carts/cart" class="btn btn-primary">Ir al carrito</a>      {{else}}        <p>Tu carrito está vacío.</p>
      {{/if}}
    </div>
  </div>


  <script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.min.js"></script>
  <script>
    Handlebars.registerHelper('multiply', (a, b) => (Number(a) * Number(b)).toFixed(2));
    Handlebars.registerHelper('formatDate', (date) => {
      if (!date) return '';
      const d = new Date(date);
      return d.toLocaleDateString('es-AR', { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' });
    });
  </script>
</body>
</html>
